<ui:composition xmlns="http://www.w3.org/1999/xhtml"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	template="../templates/main.xhtml">

	<ui:define name="title">
		let's play
	</ui:define>
	<ui:define name="content">

		<b>Logged in players:</b>
		<h:dataTable var="player" value="#{gameBean.players}">
			<h:column>
				<f:facet name="header">
							  Name
						  </f:facet>
							#{player.name}
					</h:column>
		</h:dataTable>
		
		<h:panelGroup id="teams">
				<b>PlayingTeams:</b>
		<h:dataTable var="team" value="#{gameBean.teams}">
			<h:column>
				<f:facet name="header">
							 Teamname
						  </f:facet>
							#{team.name}
					</h:column>
			<h:column>
				<f:facet name="header">
							  Points
						  </f:facet>
						#{team.points}
					</h:column>
		</h:dataTable>
		</h:panelGroup>

		<h:panelGroup id="deck">

			<h:panelGroup rendered="#{gameBean.ansager}">
				<h:form>
					<h:selectOneMenu value="#{gameBean.trump}">
						<f:selectItems value="#{gameBean.gameKinds}" />
					</h:selectOneMenu>
					<h:commandButton value="Ansagen" action="#{gameBean.ansagen}">
						<f:ajax render=":deck :GameUI" execute="@form" />
					</h:commandButton>
					<h:commandButton value="Schieben" action="#{gameBean.schieben}">
						<f:ajax render=":deck :GameUI" />
					</h:commandButton>
				</h:form>
			</h:panelGroup>

			<h:panelGroup>
				This is the card deck...<br />

				<ui:repeat value="#{gameBean.cardsSorted}" var="card">
					<h:graphicImage library="im"
						name="#{card.family}/#{card.value}.jpeg" styleClass="deckCard card-#{card.position}" />
				</ui:repeat>
			</h:panelGroup>
		</h:panelGroup>

		<h:panelGrid id="GameUI" columns="2">
			<h:column>
				<h:outputText rendered="#{gameBean.trump != null}">
							Trump is: <b>#{gameBean.trump}</b><br />
						</h:outputText>
				<h:dataTable var="l" value="#{gameBean.log}">
					<h:column>
						<f:facet name="header">
							  Last Log messages
						  </f:facet>
							#{l}
					</h:column>
				</h:dataTable>
			</h:column>

			<h:column>
				<h:form id="cards">
					<ui:repeat value="#{gameBean.cards}" var="card">
						
						<h:commandLink action="#{gameBean.playCard}">
							<f:ajax render=":deck :GameUI :teams" />
							<f:param name="cardFamily" value="#{card.family}" />
							<f:param name="cardValue" value="#{card.value}" />
							<h:graphicImage library="im"
								name="#{card.family}/#{card.value}.jpeg" styleClass="handCard" />
						</h:commandLink>
					</ui:repeat>
				</h:form>

			</h:column>

		</h:panelGrid>

		<h:outputScript>
			<!-- enable polling on this page -->
			reloadUI(#{UI.reload_time}, "cards", "deck GameUI");
		</h:outputScript>
	</ui:define>
</ui:composition>


